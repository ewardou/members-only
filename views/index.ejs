<!DOCTYPE html>
<html>
  <head>
    <title>Members only</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <% if (user) {%>
      <h1>Welcome <%= user.fullName %></h1>
      <a href="/new-message">Create new message</a>
      <a href="/join-club">Join the club</a>
      <hr>
      <a href="/admin">Become admin</a>
      <a href="/log-out">Log out</a>
      <div class="messages">
        <% if (messages) { messages.forEach(msg => {%>
          <div>
            <% if (user.isMember || user.isAdmin) {%>
              <p><%= msg.author.fullName %></p>
            <% } %>
            <p><%= msg.title %></p>
            <p><%= msg.text %></p>
            <% if (user.isMember || user.isAdmin) {%>
              <p><%= msg.timestamp %></p>
            <% } %>
            <% if (user.isAdmin) {%>
              <form action="delete/<%= msg._id %>" method="post">
                <button>Delete</button>
              </form>
            <% } %>
          </div>
        <% })} %>
      </div>
    <% } else { %>
      <h1>Please log in</h1>
      <form action="/log-in" method="post">
        <p>
          <label for="email">Email</label>
          <input type="email" name="email" id="email" autocomplete="email">
        </p>
        <p>
          <label for="pwd">Password</label>
          <input type="password" name="pwd" id="pwd">
        </p>
        <% if (error) {%>
          <p><%= error.at(-1) %></p>
        <% } %>
        <button>Log in</button>
      </form>
      <p>Or <a href="/sign-up">sign up</a></p>
    <% } %>
  </body>
</html>
